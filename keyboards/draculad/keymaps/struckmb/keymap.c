/*
Copyright 2021 @mangoiv

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

#include QMK_KEYBOARD_H
#include "struckmb.h"
#include "keymap_german.h"

#define LAYOUT_wrapper(...) LAYOUT(__VA_ARGS__)

// osm keys:
#define OS_CTL   OSM(MOD_LCTL)
#define OS_ALT   OSM(MOD_LALT)
#define OS_GUI   OSM(MOD_LGUI)
#define OS_SCTL  OSM(MOD_LSFT | MOD_LCTL)
#define OS_SALT  OSM(MOD_LSFT | MOD_LALT)
#define OS_SGUI  OSM(MOD_LSFT | MOD_LGUI)
#define OS_CTAL  OSM(MOD_LALT | MOD_LCTL)
#define OS_MEH   OSM(MOD_LCTL | MOD_LSFT | MOD_LALT)
#define OS_HYPR  OSM(MOD_LCTL | MOD_LSFT | MOD_LALT | MOD_LGUI)

// special / multi purpose keys
#define SFT_Z   LSFT_T(DE_Z)
#define SFT_SS  RSFT_T(DE_SS)
#define LY1_SPC LT(_1,KC_SPC)
//#define SPC_LY2 LT(_2,KC_SPC)
//#define ENT_LY1 LT(_1,KC_ENT)
#define LY2_ENT LT(_2,KC_ENT)
#define FN_MO13 MO(_1)
#define FN_MO23 MO(_2)
#define LAYER_3 MO(_3)
#define DE_OE_4 LT(_4,DE_ODIA)

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    [_DEFAULT] = LAYOUT_wrapper(
            _BL1_5_,_BR1_5_,
            _BL2_5_,_BR2_5_,
            _BL3_5_,_BR3_5_,
            BS_ENC0,BS_ENC1,
            _BL4_3_,_BR4_3_
            ),
    [_HRM_OFF] = LAYOUT_wrapper(
            _QL1_5_,_QR1_5_,
            _QL2_5_,_QR2_5_,
            _QL3_5_,_QR3_5_,
            BS_ENC0,BS_ENC1,
            _BL4_3_,_BR4_3_
            ),
#   ifdef COMBO_ENABLE
    [_ASETNIOP] =  LAYOUT_wrapper(
            _AL1_5_,_AR1_5_,
            _AL2_5_,_AR2_5_,
            _AL3_5_,_AR3_5_,
            BS_ENC0,BS_ENC1,
            _AL4_3_,_AR4_3_
            ),
#   endif // COMBO_ENABLE
    [_SYM_NUM] = LAYOUT_wrapper(
            _SY1_5_,_NU1_5_,
            _SY2_5_,_NU2_5_,
            _SY3_5_,_NU3_5_,
            ___2___,
            _SY4_3_,_NU4_3_
            ),
    [_NAV_FUN] = LAYOUT_wrapper(
            _NA1_5_,_FU1_5_,
            _NA2_5_,_FU2_5_,
            _NA3_5_,_FU3_5_,
            ___2___,
            _NA4_3_,_FU4_3_
            ),
    [_MSE_ADJ] = LAYOUT_wrapper(
            _MO1_5_,_AD1_5_,
            _MO2_5_,_AD2_5_,
            _MO3_5_,_AD3_5_,
            ___2___,
            _MO4_3_,_AD4_3_
            ),
};

enum custom_keycodes {
  BALL_HUI = SAFE_RANGE, //cycles hue
  BALL_WHT,              //cycles white
  BALL_DEC,              //decreased color
  BALL_SCR,              //scrolls
  BALL_NCL,              //left click
  BALL_RCL,              //right click
  BALL_MCL,              //middle click
};

#ifdef OLED_ENABLE
oled_rotation_t oled_init_user(oled_rotation_t rotation) {
    if (is_keyboard_master()) {
        return is_keyboard_left() ? OLED_ROTATION_270 : OLED_ROTATION_90;
    } else {
        return is_keyboard_left() ? OLED_ROTATION_180 : OLED_ROTATION_0;
    }
}

static void render_logo(void) {
   static const char PROGMEM drac_logo[] = {
      // 'oledlogo', 128x64px
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x1c, 0x1c, 0x1c, 0x3c, 0xfc, 0xec, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xf8,
      0x98, 0x1c, 0x1c, 0x0c, 0x0c, 0x0c, 0x1c, 0x1c, 0x9c, 0xf8, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
      0xc0, 0xe0, 0xf0, 0xf8, 0xf8, 0xfc, 0xfc, 0xfe, 0xfe, 0xfe, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xfe, 0xfe, 0xfe, 0xfc, 0xfc, 0xf8, 0xf8, 0xf0, 0xe0, 0xc0, 0x80, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x1c, 0x1c, 0x9c, 0x9c, 0x1c, 0x1c, 0x1c, 0x1c, 0x9c, 0x8c, 0x8c, 0x0f, 0x07, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
      0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x73, 0x71, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x20, 0x18, 0x1e, 0x0f, 0x07,
      0x07, 0x03, 0x03, 0x03, 0x03, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x03, 0x03, 0x03,
      0x03, 0x07, 0x07, 0x0f, 0x1f, 0x3f, 0x7f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xfe, 0xf8, 0xe0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x3e, 0x7f, 0xe3, 0xc1, 0x80, 0x80, 0x80, 0x80, 0x81, 0xc1, 0xe3, 0x7f, 0x3e, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0xfc,
      0x8e, 0x0e, 0x0e, 0x0c, 0x1c, 0x38, 0x70, 0xe0, 0xc0, 0xfe, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0xf8, 0xfc, 0xfc, 0xfe, 0xe1, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x1f, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0xc0, 0xf0, 0x30, 0x31, 0x31, 0xf1, 0xf1, 0x31, 0x31, 0x31, 0x70, 0xfc, 0x9c, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0xcc, 0xfc, 0x3c, 0x1c, 0x1c, 0x0c, 0x0c,
      0x0c, 0x0c, 0x1c, 0x3c, 0xfc, 0xcc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
      0x01, 0x18, 0x18, 0x38, 0x30, 0x30, 0x70, 0xe0, 0xe1, 0xe1, 0xc1, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x10, 0x10, 0x30, 0xf0, 0xf0, 0xf8, 0xf8, 0xff, 0xff, 0xff, 0xff, 0x04,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0x3f, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x87, 0x9f, 0x18, 0x18, 0x00, 0x01, 0x0f, 0x1c, 0x30, 0x30, 0x38, 0x1f, 0x0f, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x0f, 0x0e, 0x1c, 0x18, 0x18, 0x18,
      0x18, 0x18, 0x1c, 0x0e, 0xcf, 0xc3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x06, 0x06, 0x06, 0x07, 0x03, 0x03, 0x03, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x01, 0x01, 0x03, 0x03, 0x87, 0xc7, 0xff, 0xff, 0xff, 0x7f, 0x47, 0x03, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xc0, 0x70, 0x3f, 0x3f, 0x1f, 0x0f, 0x03,
      0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x1b, 0x1f, 0x1c, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0xff, 0x83, 0x83, 0x03, 0x1f, 0xff,
      0xc3, 0x03, 0x03, 0x87, 0xff, 0xf9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x0e, 0x1f, 0x3f, 0xff, 0x0f, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xf8, 0x1c, 0x0e, 0x06,
      0x07, 0x07, 0x03, 0x03, 0x03, 0x03, 0x07, 0x07, 0x06, 0x0e, 0x1c, 0xf8, 0xf0, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00,
      0x01, 0x03, 0x03, 0x03, 0xf9, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0x3f, 0x30, 0x30, 0x30,
      0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3f, 0x3f, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30,
      0x30, 0x30, 0x30, 0x30, 0x3f, 0x3f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
   };
  oled_write_raw_P(drac_logo, sizeof(drac_logo));
}

bool oled_task_keymap(void) {
    if (is_oled_on()) {
        if (is_keyboard_master()) {
            render_qmk_small_logo(0, 0);
            render_status_lite(5, 0, true); // Renders the current keyboard state
        } else {
            render_logo();
        }
    }
    return false;
}

#endif //OLED_ENABLE

/* uint8_t white = 0; */
/* uint8_t red = 255; */
/* uint8_t green = 0; */
/* uint8_t blue = 0; */

/* bool set_scrolling = false; */
/* report_mouse_t pointing_device_task_user(report_mouse_t mouse_report) { */
/*     if (set_scrolling) { */
/*         mouse_report.h = mouse_report.x; */
/*         mouse_report.v = mouse_report.y; */
/*         mouse_report.x = mouse_report.y = 0; */ 
/*     } */
/*     return mouse_report; */
/* } */

/* void ball_increase_hue(void){ */
/*       if(red!=255&&green!=255&&blue!=255){ */
/*         red =255; */
/*       } */
/*       if (red==255&&green<255&&blue==0){ */
/*        green += 15; */
/*       } else if(green==255&&blue==0&&red>0){ */
/*         red-=15; */
/*       } else if(red==0&&blue<255&&green==255){ */
/*         blue+=15; */
/*       } else if(blue==255&&green>0&&red==0){ */
/*         green -= 15; */
/*       } else if(green == 0&&blue==255&&red<255){ */
/*         red +=15; */
/*       } else if(green ==0&&blue>0&&red==255){ */
/*         blue -=15; */
/*       } */
/*       pimoroni_trackball_set_rgbw(red,green,blue,white); */
/* } */

/* void decrease_color(void){ */
/*   if (green>0){ */
/*     green-=15; */
/*   } */
/*   if (red>0){ */
/*     red-=15; */
/*   } */
/*   if (blue>0){ */
/*     blue-=15; */
/*   } */
/*   pimoroni_trackball_set_rgbw(red,green,blue,white); */
/* } */

/* void cycle_white(void){ */
/*   if (white<255){ */
/*     white +=15; */
/*   } else{ */
/*     white=0; */
/*   } */
/*   pimoroni_trackball_set_rgbw(red,green,blue,white); */
/* } */

/* bool process_record_user(uint16_t keycode, keyrecord_t *record){ */
/*   switch (keycode){ */
/*   case  BALL_HUI: */
/*     if(record->event.pressed){ */
/*       ball_increase_hue(); */
/*     } */
/*     break; */
/*   case BALL_WHT: */
/*     if(record-> event.pressed){ */
/*       cycle_white(); */
/*     } */
/*     break; */
/*   case BALL_DEC: */
/*    if(record-> event.pressed){ */
/*       decrease_color(); */
/*     } */
/*     break; */
/*   case BALL_SCR: */
/*    if(record->event.pressed){ */
/*      set_scrolling = true; */
/*    } else{ */
/*      set_scrolling = false; */
/*    } */
/*    break; */
/*   case BALL_NCL: */
/*      record->event.pressed?register_code(KC_BTN1):unregister_code(KC_BTN1); */
/*      break; */
/*   case BALL_RCL: */
/*       record->event.pressed?register_code(KC_BTN2):unregister_code(KC_BTN2); */
/*       break; */
/*   case BALL_MCL: */
/*       record->event.pressed?register_code(KC_BTN3):unregister_code(KC_BTN3); */
/*       break; */
/*   } */
/*   return true; */
/* } */

/* #ifdef ENCODER_ENABLE */
/* bool encoder_update_user(uint8_t index, bool clockwise) { */
/*     if (index == 0) { */
/*         switch (get_highest_layer(layer_state)) { */
/*             case _MSE_ADJ: */
/*                 clockwise?tap_code(KC_WH_U):tap_code(KC_WH_D); */
/*                 break; */
/*             default: */
/*                 // Volume control */
/*                 clockwise?tap_code(KC_VOLU):tap_code(KC_VOLD); */
/*         } */
/*     } */
/*     else if (index == 2) { */
/*         switch (get_highest_layer(layer_state)) { */
/*             case _MSE_ADJ: */
/*                 clockwise?ball_increase_hue():cycle_white(); */
/*                 break; */
/*             default: */
/*                 clockwise?tap_code(KC_PGUP):tap_code(KC_PGDN); */
/*                 break; */
/*         } */
/*     } */
/*     // I only have 2 encoders on the the pimoroni example board, just add else ifs for your other encoders... */
/*     // the missing ones are encoder 1 on the right side and encoder 3 on the left side */
/*     return true; */
/* } */
/* #endif // ENCODER_ENABLE */

